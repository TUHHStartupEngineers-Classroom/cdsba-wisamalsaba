{
  "hash": "e34fa33458ca972901c07cb795855ca7",
  "result": {
    "markdown": "---\ntitle: \"Regression Discontinuity\"\nauthor: \"Wisam Alsaba\"\nformat: \n    html:\n      code-line-numbers: true\n      df-print: paged\n---\n\n----\n#### **Assignment 10**\n\n::: {.cell hash='10_rdd_cache/html/unnamed-chunk-1_2d30f11ad47a49fd0e4e196c6582144e'}\n\n```{.r .cell-code}\n# Load necessary libraries\nlibrary(dplyr)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> \n#> Attaching package: 'dplyr'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> The following objects are masked from 'package:stats':\n#> \n#>     filter, lag\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> The following objects are masked from 'package:base':\n#> \n#>     intersect, setdiff, setequal, union\n```\n:::\n\n```{.r .cell-code}\nlibrary(ggplot2)\n\n# Read data for the current campaign\ndata_current <- readRDS('C:/Users/wisam/OneDrive/Desktop/Causal_Data_Science_Data/Data/coupon.rds')\n\n# [1] Regression Discontinuity Design Sensitivity Analysis ----\n\n# Define cut-off\ncutoff_value <- 60\n\n# Bandwidths\nbandwidth_original <- cutoff_value + c(-5, 5)\nbandwidth_half <- cutoff_value + c(-5, 5) / 2\nbandwidth_double <- cutoff_value + c(-5, 5) * 2\n\n# Function to perform regression discontinuity design analysis\nrun_rdd_analysis <- function(data, bandwidth) {\n  \n  data_below <- data %>% filter(days_since_last >= bandwidth[1] & days_since_last < cutoff_value)\n  data_above <- data %>% filter(days_since_last >= cutoff_value & days_since_last <= bandwidth[2])\n  data_combined <- bind_rows(data_above, data_below)\n  \n  lm_bandwidth <- lm(purchase_after ~ days_since_last_centered + coupon, data_combined)\n  \n  model_below <- lm(purchase_after ~ days_since_last, data_below)\n  model_above <- lm(purchase_after ~ days_since_last, data_above)\n  \n  y0 <- predict(model_below, tibble(days_since_last = cutoff_value))\n  y1 <- predict(model_above, tibble(days_since_last = cutoff_value))\n  \n  treatment_effect <- y1 - y0\n  return(list(LATE = treatment_effect, Summary = summary(lm_bandwidth)))\n}\n\n# Run analysis with original bandwidth\nLATE_original <- run_rdd_analysis(data_current, bandwidth_original)\n\n# Run analysis with half the bandwidth\nLATE_half_bandwidth <- run_rdd_analysis(data_current, bandwidth_half)\n\n# Run analysis with double the bandwidth\nLATE_double_bandwidth <- run_rdd_analysis(data_current, bandwidth_double)\n\n# Printing results\ncat(\"Original Bandwidth:\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> Original Bandwidth:\n```\n:::\n\n```{.r .cell-code}\ncat(\"LATE:\", LATE_original$LATE, \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> LATE: 7.989037\n```\n:::\n\n```{.r .cell-code}\nprint(LATE_original$Summary)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = purchase_after ~ days_since_last_centered + coupon, \n#>     data = data_combined)\n#> \n#> Residuals:\n#>      Min       1Q   Median       3Q      Max \n#> -11.4966  -2.1312  -0.0949   2.0185  10.4159 \n#> \n#> Coefficients:\n#>                          Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept)               11.4242     0.3965  28.813  < 2e-16 ***\n#> days_since_last_centered   0.3835     0.1259   3.046  0.00251 ** \n#> couponTRUE                 7.9334     0.7087  11.194  < 2e-16 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 3.186 on 320 degrees of freedom\n#> Multiple R-squared:  0.7074,\tAdjusted R-squared:  0.7055 \n#> F-statistic: 386.8 on 2 and 320 DF,  p-value: < 2.2e-16\n```\n:::\n\n```{.r .cell-code}\ncat(\"\\nHalf the Bandwidth:\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Half the Bandwidth:\n```\n:::\n\n```{.r .cell-code}\ncat(\"LATE:\", LATE_half_bandwidth$LATE, \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> LATE: 7.362377\n```\n:::\n\n```{.r .cell-code}\nprint(LATE_half_bandwidth$Summary)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = purchase_after ~ days_since_last_centered + coupon, \n#>     data = data_combined)\n#> \n#> Residuals:\n#>      Min       1Q   Median       3Q      Max \n#> -10.9680  -2.2013   0.1676   2.1516   8.2567 \n#> \n#> Coefficients:\n#>                          Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept)               11.6612     0.5747  20.292  < 2e-16 ***\n#> days_since_last_centered   0.6883     0.3219   2.138   0.0339 *  \n#> couponTRUE                 7.1679     1.0172   7.047 3.87e-11 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 3.289 on 178 degrees of freedom\n#> Multiple R-squared:  0.6622,\tAdjusted R-squared:  0.6584 \n#> F-statistic: 174.5 on 2 and 178 DF,  p-value: < 2.2e-16\n```\n:::\n\n```{.r .cell-code}\ncat(\"\\nDouble the Bandwidth:\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Double the Bandwidth:\n```\n:::\n\n```{.r .cell-code}\ncat(\"LATE:\", LATE_double_bandwidth$LATE, \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> LATE: 9.513531\n```\n:::\n\n```{.r .cell-code}\nprint(LATE_double_bandwidth$Summary)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = purchase_after ~ days_since_last_centered + coupon, \n#>     data = data_combined)\n#> \n#> Residuals:\n#>      Min       1Q   Median       3Q      Max \n#> -12.2718  -2.0858  -0.0003   2.0275  10.6749 \n#> \n#> Coefficients:\n#>                          Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept)              10.61700    0.27386  38.767   <2e-16 ***\n#> days_since_last_centered  0.01413    0.04255   0.332     0.74    \n#> couponTRUE                9.51584    0.48628  19.569   <2e-16 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 3.115 on 626 degrees of freedom\n#> Multiple R-squared:  0.7052,\tAdjusted R-squared:  0.7042 \n#> F-statistic: 748.6 on 2 and 626 DF,  p-value: < 2.2e-16\n```\n:::\n\n```{.r .cell-code}\n# Output explanations with altered variable names\ncat(\"   ## There is no change in the three bandwidth choices on the statistical effect (positive effect of \n      coupon variable on purchase_after.\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>    ## There is no change in the three bandwidth choices on the statistical effect (positive effect of \n#>       coupon variable on purchase_after.\n```\n:::\n\n```{.r .cell-code}\ncat(\"   ## The estimated LATE is slightly lower for the half bandwidth than the original bandwidth, \n      suggesting a more conservative estimate.\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>    ## The estimated LATE is slightly lower for the half bandwidth than the original bandwidth, \n#>       suggesting a more conservative estimate.\n```\n:::\n\n```{.r .cell-code}\ncat(\"   ## The estimated LATE is higher for the double bandwidth than the original bandwidth, suggesting a \n      potentially broader impact on individuals farther from the cutoff point.\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>    ## The estimated LATE is higher for the double bandwidth than the original bandwidth, suggesting a \n#>       potentially broader impact on individuals farther from the cutoff point.\n```\n:::\n\n```{.r .cell-code}\ncat(\"   ## Bandwidth choice influences treatment (coupon TRUE) effect estimation.\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>    ## Bandwidth choice influences treatment (coupon TRUE) effect estimation.\n```\n:::\n\n```{.r .cell-code}\ncat(\"   ## Coefficients vary with bandwidth changes.\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>    ## Coefficients vary with bandwidth changes.\n```\n:::\n\n```{.r .cell-code}\n# [2] Different Past Campaign ----\n\n# Read data for the different past campaign\ndata_shipping <- readRDS('C:/Users/wisam/OneDrive/Desktop/Causal_Data_Science_Data/Data/shipping.rds')\n\nlibrary(rddensity)\nrdd_density <- rddensity(data_shipping$purchase_amount, c = 30)\nsummary(rdd_density)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Manipulation testing using local polynomial density estimation.\n#> \n#> Number of obs =       6666\n#> Model =               unrestricted\n#> Kernel =              triangular\n#> BW method =           estimated\n#> VCE method =          jackknife\n#> \n#> c = 30                Left of c           Right of c          \n#> Number of obs         3088                3578                \n#> Eff. Number of obs    2221                1955                \n#> Order est. (p)        2                   2                   \n#> Order bias (q)        3                   3                   \n#> BW est. (h)           22.909              20.394              \n#> \n#> Method                T                   P > |T|             \n#> Robust                5.9855              0\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning in summary.CJMrddensity(rdd_density): There are repeated observations.\n#> Point estimates and standard errors have been adjusted. Use option\n#> massPoints=FALSE to suppress this feature.\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> P-values of binomial tests (H0: p=0.5).\n#> \n#> Window Length / 2          <c     >=c    P>|T|\n#> 0.261                      20      26    0.4614\n#> 0.522                      41      65    0.0250\n#> 0.783                      62     107    0.0007\n#> 1.043                      81     136    0.0002\n#> 1.304                     100     169    0.0000\n#> 1.565                     114     196    0.0000\n#> 1.826                     132     227    0.0000\n#> 2.087                     156     263    0.0000\n#> 2.348                     173     298    0.0000\n#> 2.609                     191     331    0.0000\n```\n:::\n\n```{.r .cell-code}\ncat(\"   ## The manipulation tests indicate significant evidence of manipulation around the cut-off point (c=30)\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>    ## The manipulation tests indicate significant evidence of manipulation around the cut-off point (c=30)\n```\n:::\n\n```{.r .cell-code}\ncat(\"   ## P-values of the robust T-statistic are close to zero, suggesting that there are systematic changes in the observed\n      density of the purchase_amount variable near the cut-off.\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>    ## P-values of the robust T-statistic are close to zero, suggesting that there are systematic changes in the observed\n#>       density of the purchase_amount variable near the cut-off.\n```\n:::\n\n```{.r .cell-code}\ncat(\"   ## The order of estimation and bias is also different on each side, suggesting a lack of smoothness or continuity.\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>    ## The order of estimation and bias is also different on each side, suggesting a lack of smoothness or continuity.\n```\n:::\n\n```{.r .cell-code}\ncat(\"   ## The p-values of binomial tests provide further evidence of non-random behavior around the cut-off.\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>    ## The p-values of binomial tests provide further evidence of non-random behavior around the cut-off.\n```\n:::\n\n```{.r .cell-code}\ncat(\"   ## The purchase_amount variable, based on the results of manipulation testing, may not be appropriate as a running \n      variable for an RDD with a cut-off at 30€\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>    ## The purchase_amount variable, based on the results of manipulation testing, may not be appropriate as a running \n#>       variable for an RDD with a cut-off at 30€\n```\n:::\n\n```{.r .cell-code}\n# Plotting histogram for confirmation\nggplot(data_shipping, aes(x = purchase_amount)) +\n  geom_histogram(binwidth = 5, fill = \"black\", color = \"white\") +\n  geom_vline(xintercept = 30, color = \"blue\", linetype = \"dashed\") +\n  xlab(\"Purchase Amount (€)\") +\n  ylab(\"Number of Purchases\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](10_rdd_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n:::",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}